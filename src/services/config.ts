import fs from 'fs/promises';
import path from 'path';

// 定义配置对象的类型结构
interface Config {
    navItems?: { name: string; url: string; icon: string }[];
    weather?: { cities: string[] };
    background?: { type: string; value: string };
    search?: {
        engines: { name: string; url: string; icon: string; custom?: boolean }[];
        defaultEngine: string;
    };
    passwordHash?: string;
    hasPassword?: boolean;
}

const configPath = path.join(process.cwd(), 'config.json');

const defaultConfig: Config = {
    navItems: [{ name: '我的路由器', url: 'http://192.168.1.1', icon: 'prebuilt:router' }],
    weather: { cities: ['北京'] },
    background: { type: 'bing', value: '' },
    search: {
        engines: [
            { 
                name: 'Google', 
                url: 'https://www.google.com/search?q=%s', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12C5,7.9 8.2,4.73 12.19,4.73C14.03,4.73 15.69,5.36 16.95,6.57L19.04,4.5C17.02,2.62 14.71,1.73 12.19,1.73C6.7,1.73 2.13,6.2 2.13,12C2.13,17.8 6.7,22.27 12.19,22.27C17.85,22.27 21.64,18.33 21.64,12.27C21.64,11.77 21.52,11.42 21.35,11.1Z"/></svg>',
                custom: false
            },
            { 
                name: '百度', 
                url: 'https://www.baidu.com/s?wd=%s', 
                icon: '<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">  <image id="image0" width="24" height="24" x="0" y="0" href="data:image/png;base64,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" ></image></svg>',
                custom: false
            }
        ],
        defaultEngine: 'Google'
    }
};

export async function readConfig(): Promise<Config> {
    try {
        await fs.access(configPath);
        const fileContent = await fs.readFile(configPath, 'utf-8');
        const configData = JSON.parse(fileContent) as Config;
        
        const baseEngines = defaultConfig.search?.engines || [];
        const customEngines = configData.search?.engines?.filter(e => e.custom) || [];
        
        // Safely merge search config to avoid type errors
        const mergedSearchConfig = {
            ...defaultConfig.search,
            ...configData.search,
            engines: [...baseEngines, ...customEngines]
        };
        // Ensure defaultEngine is valid
        if (!mergedSearchConfig.engines.some(e => e.name === mergedSearchConfig.defaultEngine)) {
            mergedSearchConfig.defaultEngine = baseEngines[0]?.name || '';
        }

        configData.search = mergedSearchConfig as Config['search'];

        return configData;
    } catch (error) {
        console.log("配置文件不存在或读取失败，将创建默认配置。");
        await fs.writeFile(configPath, JSON.stringify(defaultConfig, null, 2));
        return defaultConfig;
    }
}

export async function saveConfig(data: Partial<Config>): Promise<void> {
    try {
        const fullConfig = { ...data };
        if (fullConfig.search?.engines) {
            // Only save the custom engines to the file
            fullConfig.search.engines = fullConfig.search.engines.filter(e => e.custom);
        }
        await fs.writeFile(configPath, JSON.stringify(fullConfig, null, 2));
    } catch (error) {
        console.error("保存配置文件失败:", error);
        throw error;
    }
}
